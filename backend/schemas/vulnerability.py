"""
Vulnerability schemas.
"""
from pydantic import BaseModel, Field
from typing import Optional, List, Dict
from datetime import datetime
from models.vulnerability import Severity, VulnerabilityType


class VulnerabilityResponse(BaseModel):
    """Schema for vulnerability response."""
    id: int
    
    # Classification
    vulnerability_type: VulnerabilityType
    severity: Severity
    cvss_score: Optional[float] = None
    
    # Location
    url: str
    file_path: Optional[str] = None
    parameter: Optional[str] = None
    method: str = "GET"
    
    # Details
    title: str
    description: str
    evidence: Optional[str] = None
    
    # AI Analysis
    ai_confidence: float = 0.0
    ai_analysis: Optional[str] = None
    
    # Remediation
    remediation: Optional[str] = None
    remediation_code: Optional[str] = None
    reference_links: List[str] = []
    
    # OWASP Mapping
    owasp_category: Optional[str] = None
    cwe_id: Optional[str] = None
    
    # Status
    is_false_positive: bool = False
    is_verified: bool = False
    is_fixed: bool = False
    is_suppressed: bool = False
    suppression_reason: Optional[str] = None
    
    # Final Verdict Layer
    final_verdict: Optional[str] = None
    action_required: bool = True
    detection_confidence: float = 0.0
    exploit_confidence: float = 0.0
    
    # Scope & Impact
    scope_impact: Optional[Dict] = None
    
    detected_by: Optional[str] = None
    detected_at: datetime
    
    scan_id: int
    
    class Config:
        from_attributes = True


class VulnerabilityUpdate(BaseModel):
    """Schema for updating vulnerability status."""
    is_false_positive: Optional[bool] = None
    is_verified: Optional[bool] = None
    is_fixed: Optional[bool] = None


class VulnerabilityListResponse(BaseModel):
    """Schema for paginated vulnerability list."""
    items: List[VulnerabilityResponse]
    total: int
    page: int
    size: int


class VulnerabilitySummary(BaseModel):
    """Summary of vulnerabilities by severity."""
    total: int
    critical: int
    high: int
    medium: int
    low: int
    info: int
